<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"> 
        <title>📤산악회 등반(트래킹)신청서</title>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function () {
                // 현재 신청인원 불러오기
                $.get(
                    'https://script.google.com/macros/s/AKfycbxHpu_I2T2M8JLxHgRLSqDFzRIogTx-x4OcLf9' +
                            'CxjziJQb5_vBFp9TCStU2JpKca_m4Iw/exec?totalParticipants=true',
                    function (response) {
                        $('#currentParticipants').text(
                            `🤷‍♂️현재 총 ${response.total}명이 참가 신청중입니다 \n(⚠${response.waiting}명은 접수 대기중입니다.)`
                        );
                        window.totalParticipants = response.total; // 전역 변수로 저장
                    },
                    'json'
                );

                // 제출하기
                $('#signupForm').on('submit', function (event) {
                    event.preventDefault();

                    var formData = {
                        name: $('#name').val(),
                        tel: $('#tel').val(),
                        join: $('#join').val(),
                        joinbaby: $('#joinbaby').val(),
                        joinoption: $('#joinoption').val(),
                        etc: $('#etc').val()
                    };

                    var confirmationMessage = `🤷‍♀️입력하신 내용을 확인해 주세요 \n
        - 성  명: ${formData.name}
        - 연락처: ${formData.tel}
        - 참석인원: ${formData.join}
        - 예비회원: ${formData.joinbaby}
        - 선택 코스: ${formData.joinoption}\n`;

                    if (confirm(confirmationMessage + '\n이대로 제출하시겠습니까?')) {
                        // 버튼 비활성화 및 로딩 메시지 표시
                        var $submitButton = $('#signupButton');
                        $submitButton
                            .prop('disabled', true)
                            .text('📤제출중...');

                        $
                            .post(
                                'https://script.google.com/macros/s/AKfycbxHpu_I2T2M8JLxHgRLSqDFzRIogTx-x4OcLf9' +
                                        'CxjziJQb5_vBFp9TCStU2JpKca_m4Iw/exec',
                                formData,
                                function (response) {
                                    alert(response.message);
                                },
                                'json'
                            )
                            .always(function () {
                                // 완료 후 버튼 상태 복원
                                $submitButton
                                    .prop('disabled', false)
                                    .text('📤제출하기');
                            });
                    }
                });

                // 조회하기
                    $('#searchButton').on('click', function () {
                    var $searchButton = $('#searchButton');
                    alert('🤷‍♀️조회중입니다. 잠시후 결과를 아래에 표시합니다. \n접수상태는 약 1분후에 반영 됩니다.');
                    $searchButton
                        .prop('disabled', true)
                        .text('🔎조회중...');
                
                    var tel = $('#telInput').val();
                
                    $('html, body').animate({
                        scrollTop: $('#searchResult').offset().top
                    }, 1000);
                
                    $.get(
                        'https://script.google.com/macros/s/AKfycbxHpu_I2T2M8JLxHgRLSqDFzRIogTx-x4OcLf9CxjziJQb5_vBFp9TCStU2JpKca_m4Iw/exec',
                        {
                            tel: tel
                        },
                        function (response) {
                            if (response.status === 'success') {
                                var data = response.data;
                                var formattedResult = `▶성명: ${data.name} /\n참석인원: ${data.join}명 /\n코스: ${data.joinoption} /\n접수상태: ${data.state}`;
                                $('#searchResult').text(formattedResult);
                
                                $('#updateSection').show();
                                $('#currentTel').val(data.tel);
                                $('#currentJoin').val(data.join);
                
                                updateJoinOptions(parseInt(data.join));
                            } else {
                                alert(response.message);
                            }
                        },
                        'json'
                    )
                    .always(function () {
                        $searchButton
                            .prop('disabled', false)
                            .text('🔎조회하기');
                    });
                });
                
                // 변경하기
                $('#updateButton').on('click', function () {
                    var $updateButton = $('#updateButton');
                    $updateButton
                        .prop('disabled', true)
                        .text('🔁변경(취소) 처리중...');

                    var tel = $('#currentTel').val();
                    var newJoin = $('#newJoin').val();
                    var currentJoin = $('#currentJoin').val();

                    if (parseInt(newJoin) === parseInt(currentJoin)) {
                        alert('현재 신청된 인원과 같습니다. 다른 값을 선택해 주세요.');
                        $updateButton
                            .prop('disabled', false)
                            .text('🔁변경하기');
                        return;
                    }

                    // 취소 여부 확인
                    if (parseInt(newJoin) === 0) {
                        if (!confirm('🤷참석을 취소 하는것이 맞나요?\n')) {
                            $updateButton
                                .prop('disabled', false)
                                .text('🔁변경하기');
                            return;
                        }
                    }

                    var confirmationMessage = `🤷‍♀️변경신청내용확인:\n
  - 현재 신청 인원: ${currentJoin}명
  - 변경 후 인원: ${newJoin}명\n`;

                    if (confirm(confirmationMessage + '\n이대로 변경(취소) 할까요?\n 접수상태는 약 1분후에 반영됩니다. \n')) {
                        $
                            .post(
                                'https://script.google.com/macros/s/AKfycbxHpu_I2T2M8JLxHgRLSqDFzRIogTx-x4OcLf9' +
                                        'CxjziJQb5_vBFp9TCStU2JpKca_m4Iw/exec',
                                {
                                    tel: tel,
                                    join: newJoin
                                },
                                function (response) {
                                    alert(response.message);
                                },
                                'json'
                            )
                            .always(function () {
                                // 완료 후 버튼 상태 복원
                                $updateButton
                                    .prop('disabled', false)
                                    .text('🔁변경하기');
                            });
                    } else {
                        // 사용자가 취소를 선택한 경우
                        $updateButton
                            .prop('disabled', false)
                            .text('🔁변경하기');
                    }
                });

                function updateJoinOptions(currentJoin) {
                    var totalParticipants = window.totalParticipants;
                    var joinSelect = $('#newJoin');
                    joinSelect.empty();

                    for (var i = 0; i <= 5; i++) {
                        if (totalParticipants > 40 && i >= currentJoin) {
                            /* alert('⚠신청인원이 40명을 초과하는 경우 현재보다 적게만 변경하실 수 있습니다'); */
                            continue; // 40명을 초과한 경우 현재 신청인원보다 큰 값은 추가하지 않음
                        }
                        joinSelect.append(new Option(i + (
                            i === 0
                                ? '(취소)'
                                : '명'
                        ), i));
                    }
                }
            });
        </script>
        <style>
            body {
                margin: 20px;
            }
            #searchResult {
                font-weight: 600;
                font-size: large;
                color: coral;
            }
            #currentParticipants {
                font-weight: 600;
                font-size: large;
                color: crimson;
            }
            .input-group-text {
                width: 130px;
                text-align: center;
            }
            img {
                width: 100%;
                border-radius: 10px;
            }
            #shownotice {
                display: none;
            }
            .slideshow-container {
                position: relative;
                width: 100%;
                height: 350px;
                /* 이 값은 이미지 크기에 맞게 조정하세요 */
                max-width: 600px;
                margin: auto;
                overflow: hidden;
                opacity: 1;
                transition: opacity 2s ease-in-out;
            }
            .slideshow-image {
                width: 100%;
                height: 100%;
                position: absolute;
                top: 0;
                left: 0;
                opacity: 0;
                transition: opacity 2s ease-in-out;
            }
            .visible {
                opacity: 1;
            }
            .watermark {
                position: absolute;
                bottom: 10px;
                right: 10px;
                color: rgba(255, 255, 255, 0.7);
                font-size: 21px;
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
                z-index: 10;
            }
            @media (max-width: 600px) {
                .watermark {
                    font-size: 18px;
                }
            }
        </style>
    </head>
    <body>
        <div class="slideshow-container">
            <div class="slide">
                <img src="img/dota01.jpg" class="slideshow-image">
                <div class="watermark">🏞️두타산+추암촛대바위(2024.9.7토)</div>
            </div>
            <div class="slide">
                <img src="img/dota02.jpg" class="slideshow-image">
            </div>
            <div class="slide">
                <img src="img/dota03.jpg" class="slideshow-image">
                <!-- <div class="watermark">🏞️두타산(산행일정:2024.7.6토)</div> -->
            </div>
            <div class="slide">
                <img src="img/dota04.jpg" class="slideshow-image">
            </div>
            <div class="slide">
                <img src="img/dota05.jpg" class="slideshow-image">
                <!-- <div class="watermark">🏞️두타산(산행일정:2024.7.6토)</div> -->
            </div>
            <div class="slide">
                <img src="img/lock01.jpg" class="slideshow-image">
            </div>
            <div class="slide">
                <img src="img/lock02.jpg" class="slideshow-image">
            </div>
        </div>
        <h4>
            <b>📢9월 동해 두타산(추암촛대바위)산행 일정</b>
        </h4><br>
        <p>
            9월에는 7월에 우천으로 취소된 무릉계곡을 품은 동해 두타산으로 다시 도전 합니다.
            <br>
            추가로, 추암촛대바위도 경유하여 산과 바다를 함께 즐기실 수 있습니다.
            <br><br>
            📅일시: 2024.9.7(토) 6시 ~ 19시<br>
            🏕 장소 : 동해 두타산 + 추암촛대바위(출렁다리)<br>
            A코스: 배틀바위+두타산성(산행 5시간/난이도:중상)<br>
            B코스: 무릉계곡 코스(트래킹 4시간 난이도:하)<br>
            ⭐경유: 추암촛대바위(출렁다리)<br><br>
            💳 참가비[아침간단식 + 하산식 포함]<br>
            A코스|B코스: 2.5만원(비회원 4만원)<br><br>
            📅신청기간: ~ 8.4일(일)까지 (동아리 회원 우선 신청)<br>
            ⚠ 40명 선착순 모집 후 잔여좌석에 한해 비회원 모집<br>
        </p>
    </div>
    <div class="container">
        <h5 class="mb-4">산악회 등산(트래킹) 신청하기</h5>
        <form id="signupForm" class="mb-5">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="name-label">이름</span>
                </div>
                <input
                    type="text"
                    class="form-control"
                    id="name"
                    name="name"
                    required="required"
                    aria-describedby="name-label">
            </div>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="tel-label">연락처</span>
                </div>
                <input
                    type="number"
                    class="form-control"
                    id="tel"
                    name="tel"
                    placeholder="숫자만 입력"
                    required="required"
                    aria-describedby="tel-label">
            </div>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="join-label">참석인원</span>
                </div>
                <select
                    id="join"
                    name="join"
                    class="form-select"
                    required="required"
                    aria-describedby="join-label">
                    <option value="">선택하세요</option>
                    <option value="1">1명</option>
                    <option value="2">2명</option>
                    <option value="3">3명</option>
                    <option value="4">4명</option>
                    <option value="5">5명</option>
                </select>
            </div>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="joinbaby-label">예비회원 인원</span>
                </div>
                <select
                    id="joinbaby"
                    name="joinbaby"
                    class="form-select"
                    required="required"
                    aria-describedby="joinbaby-label">
                    <option value="">선택하세요</option>
                    <option value="0">없음</option>
                    <option value="1">1명</option>
                    <option value="2">2명</option>
                    <option value="3">3명</option>
                    <option value="4">4명</option>
                    <option value="5">5명</option>
                </select>
            </div>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="joinoption-label">코스는?</span>
                </div>
                <select
                    id="joinoption"
                    name="joinoption"
                    class="form-select"
                    required="required"
                    aria-describedby="joinoption-label">
                    <option value="">선택하세요</option>
                    <option value="A코스(산행/배틀바위코스)">A코스(산행/배틀바위코스)</option>
                    <option value="B코스(트래킹/무릉계속코스)">B코스(트래킹/무릉계곡코스)</option>
                </select>
            </div>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="etc-label">💬기타 코멘트</span>
                </div>
                <input
                    type="text"
                    class="form-control"
                    id="etc"
                    name="etc"
                    aria-describedby="etc-label">
            </div>
            <button type="submit" id="signupButton" class="btn btn-primary btn-block">📤제출하기</button>
        </form>
        <div id="currentParticipants" class="mb-4"></div>
        <hr>
        <h4 class="mb-4">🔎신청내역 조회 및 변경(취소)하기</h4>
        <div class="mb-3">
            <label for="telInput" class="form-label">🤷‍♂️연락처 입력 후 조회하세요</label>
            <input
                type="number"
                class="form-control"
                id="telInput"
                placeholder="숫자만 입력"
                name="telInput">
        </div>
        <button
            id="searchButton"
            class="btn btn-dark mb-3"
            style="color: whitesmoke; font-weight: 600;">🔎조회하기</button>
        <h5 id="searchResult"></h5>
        <br>
        <div id="updateSection" style="display:none;">
            <h4 class="mb-4">🔁참석인원 변경(취소)하기</h4>
            <input type="hidden" id="currentTel">
            <input type="hidden" id="currentJoin">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="newJoin-label">변경할 참석인원:</span>
                </div>
                <select id="newJoin" class="form-select" aria-describedby="newJoin-label">
                    <!-- 옵션은 JavaScript로 동적으로 추가됩니다. -->
                </select>
            </div>
            <button id="updateButton" class="btn btn-danger">🔁변경하기</button>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const images = document.querySelectorAll(".slideshow-image");
            let currentImageIndex = 0;
            images[currentImageIndex]
                .classList
                .add("visible"); // 초기 이미지를 보이게 설정

            setInterval(function () {
                // 현재 이미지의 클래스를 제거하여 숨깁니다.
                images[currentImageIndex]
                    .classList
                    .remove("visible");

                // 현재 이미지 인덱스와 다른 랜덤 인덱스를 생성합니다.
                let nextImageIndex;
                do {
                    nextImageIndex = Math.floor(Math.random() * images.length);
                } while (nextImageIndex === currentImageIndex);

                // 다음 이미지 인덱스를 현재 이미지 인덱스로 설정합니다.
                currentImageIndex = nextImageIndex;

                // 다음 이미지의 클래스를 추가하여 보이게 합니다.
                images[currentImageIndex]
                    .classList
                    .add("visible");
            }, 5000); // 5초 간격으로 이미지를 전환합니다.
        });

        let slideIndex = 0;
        showSlides();

        function showSlides() {
            let slides = document.getElementsByClassName("slide");
            for (let i = 0; i < slides.length; i++) {
                slides[i]
                    .getElementsByClassName("slideshow-image")[0]
                    .classList
                    .remove("active");
            }
            slideIndex++;
            if (slideIndex > slides.length) {
                slideIndex = 1;
            }
            slides[slideIndex - 1]
                .getElementsByClassName("slideshow-image")[0]
                .classList
                .add("active");
            setTimeout(showSlides, 3000); // Change image every 5 seconds
        }
    </script>
</body>
</html>